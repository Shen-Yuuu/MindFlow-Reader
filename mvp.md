# MindFlow Reader - Web 应用开发细化方案

## 一、项目架构升级

我们将 MindFlow Reader 开发为一个功能完整的 Web 应用，同时内置多种 AI 模型辅助实现核心功能，并保持对心流体验的关注。

**基础架构:**

```
MindFlow Reader (Web Version)
├── 后端服务层
│   ├── 文献处理服务 (PDF解析、文本提取 - 使用 PyMuPDF)
│   ├── AI分析服务 (主要通过调用外部 API 如 HanLP, OwnThink; 本地轻量级模型为辅助或远期规划)
│   ├── 知识图谱服务 (当前为内存模拟管理，使用 Python 字典/列表; 远期规划图数据库如 Neo4j)
│   └── 数据存储服务 (当前主要为服务运行时内存存储; 远期规划数据库如 PostgreSQL, Redis)
├── 前端功能层
│   ├── 智能文献预处理模块
│   ├── 实时辅助交互模块
│   ├── 心流维持模块
│   └── 个性化知识沉淀模块
└── 界面层
    ├── 主阅读界面
    ├── 知识图谱可视化界面
    ├── 个人知识库界面
    └── 设置界面
```

## 二、技术选型升级

### 1. 基础框架

#### 前端

- **框架:** `Vue.js`
- **状态管理:** `Pinia`
- **UI组件库:** `Vuetify`
- **路由:** `Vue Router`

#### 后端

- **框架:** `FastAPI` (Python)
- **PDF处理:** `PyMuPDF` (用于后端解析)
- **知识图谱/数据存储:** 当前为 **`内存模拟知识存储 (Python 字典/列表)`**，用于存储概念和关系。远期规划可考虑 `Neo4j` (图数据管理)。
- **数据库 (关系型/缓存):** `PostgreSQL` 和 `Redis` 为远期规划，当前未在后端核心逻辑中集成。

#### 部署与运行

- **部署:** 使用 `Docker` 构建容器化服务
- **前端托管:** `Vercel` 或 `Netlify`
- **后端托管:** `AWS Lambda` 或 `Google Cloud Run`

### 2. 核心库

#### 后端库

- **AI和NLP:**
  - `HanLP (通过 RESTful API)`: 用于中文核心概念识别 (NER)。
  - `wikipedia` (Python 库): 辅助进行术语的验证和过滤，配合本地维基百科标题语料库。
  - (注意: 原计划的 `spaCy`, `sentence-transformers`, `scikit-learn`, `Hugging Face Transformers`, `ONNX Runtime` 等本地模型或库当前未在核心后端代码中集成，未来可按需引入。)
- **知识图谱 (内存操作):** `NetworkX` (可选，用于复杂图操作和分析，当前主要通过Python原生数据结构处理)。

#### 前端库

- **PDF渲染:** `@tato30/vue-pdf` (基于 `pdfjs-dist`)
- **图表可视化:** `D3.js` 和 `ECharts` (均已集成)
- **数学公式:** `KaTeX` (已集成)
- **HTTP客户端:** `axios`

## 三、各模块详细实现方案

### 1. 智能文献预处理模块

#### 1.1 文献导入与解析

- **核心功能:** 提供文件上传接口，并支持以下功能：

  - 文本提取
  - 图片和表格位置识别
  - 章节、标题和引用的自动标记

- **接口示例:**

  ```python
  # FastAPI 示例
  from fastapi import FastAPI, File, UploadFile

  app = FastAPI()

  @app.post("/upload")
  async def upload_file(file: UploadFile):
      # 使用 PyMuPDF 提取 PDF 内容
      doc = fitz.open(stream=await file.read(), filetype="pdf")
      structured_content = []
      for page in doc:
          structured_content.append(page.get_text("dict"))
      return {"content": structured_content}
  ```

#### 1.2 核心概念识别 (NER增强)

- **多层次实体识别:**

  - 通用学术实体
  - 领域特定术语
  - 公式和引用标记

- **使用后端主导方式:**
  - 前端发送文本至后端。
  - 后端调用 `HanLP RESTful API` 进行中文核心实体识别，并可结合本地 `wikipedia` 标题语料库进行概念的补充验证或过滤。

#### 1.3 知识图谱构建

- **概念节点创建:** 当前使用 `Python 字典和列表 (内存模拟)` 存储实体及其基本属性和关系。
- **关系提取策略:** 基于规则、HanLP依存句法分析结果、共现统计和上下文向量 (部分实现或规划中)。
- **远期规划:** 迁移到 `Neo4j` 等图数据库进行更持久和高效的管理。

#### 1.4 断点预测系统 (认知陡坡标注)

- **多维特征提取:** 后端 API 根据请求的文本段落，分析其特征，如：
  - 通过 HanLP 提取的专业术语密度。
  - 公式、图片、表格的存在和数量 (通过 PyMuPDF 页面分析获得)。
  - 段落长度等。
- **输出:** API 返回认知负荷评估结果，可用于前端热力图数据或提示。

### 2. 实时辅助交互模块

#### 2.1 高级阅读界面

- **功能:**

  - 平滑滚动
  - 文本高亮
  - 悬停/点击触发术语解释

- **前端代码示例:**

  ```jsx
  import React from 'react'

  const Reader = ({ content }) => {
    const handleHover = (term) => {
      // 显示解释窗口
    }

    return (
      <div>
        {content.map((section, index) => (
          <p key={index} onMouseOver={() => handleHover(section.term)}>
            {section.text}
          </p>
        ))}
      </div>
    )
  }

  export default Reader
  ```

#### 2.2 三级解释系统

- **Level 1 (快速查看):**
  - 从后端维护的内存知识图谱中获取已提取的概念关联信息。
  - 检查是否有针对该术语的缓存定义 (例如，之前从 OwnThink API 获取的)。
- **Level 2 (深度解析):**
  - 前端调用后端的 `/definition/{term}` API。
  - 后端此 API 内部调用外部 `OwnThink API` (或其他类似知识库API) 获取详细定义。
- **Level 3 (上下文增强):**
  - 结合当前阅读文本的上下文，以及从内存知识图谱中提取的相关概念和关系，辅助理解。

#### 2.3 跨文献智能导航

- 自动检测引用并增强显示。
- 提供文献网络图谱可视化。

### 3. 心流维持与个性化模块

#### 3.1 动态解释窗口

- 提供浮动窗口显示术语解释，并支持个性化配置。

#### 3.2 专注模式

- 实现全屏无干扰阅读。
- 自动隐藏非必要 UI 元素。

#### 3.3 个性化知识沉淀

- 提供学习轨迹可视化。
- 提供 AI 辅助笔记功能。

## 四、AI模型内置方案

### 1. 应用内AI引擎架构 (当前以API调用为主)

```
AI引擎 (Web - 后端)
├── API调用与结果管理器
│   ├── HanLP API 模块 (负责与 HanLP RESTful API 通信)
│   ├── OwnThink API 模块 (负责与 OwnThink API 通信)
│   ├── (远期) 本地模型加载与推理模块
│   └── 结果缓存器 (缓存来自外部API的响应，如术语定义、NER结果)
├── 任务协调器
│   ├── API请求构造与分发
│   └── (远期) 本地/远程任务调度
└── 核心能力 (通过API实现)
    ├── 术语识别模型 (HanLP NER)
    ├── 文本理解模型 (HanLP 依存句法等)
    ├── 解释生成模型 (OwnThink API)
    └── (远期) 其他专用本地模型
```

### 2. 离线/在线混合策略 (当前强依赖在线服务)

- **本地/缓存优先:**
  - 对于已处理并存储在后端内存知识图谱中的文献概念和关系，可直接查询。
  - 对于已通过 OwnThink API 获取并缓存的术语定义，可直接从缓存读取。
- **在线增强 (核心功能):**
  - 核心的中文概念识别 (NER) 依赖在线的 `HanLP RESTful API`。
  - 核心的术语定义获取依赖在线的 `OwnThink API`。
  - 模型更新和更复杂的分析任务依赖外部API的更新和服务能力。

## 五、分阶段实施路线图

### 智能文献预处理模块开发 (已部分完成，持续迭代):

- **文献导入与解析 (已实现):** 实现 PDF 文献的文本、图片和表格位置提取 (使用 PyMuPDF)。
- **核心概念识别 (已实现):** 利用 `HanLP RESTful API` 识别文献中的中文核心术语，并结合本地维基百科标题语料库进行过滤/验证。
- **知识图谱构建 (内存版 - 已实现基础):**
  - 将识别出的核心概念作为节点存储在内存中 (Python 字典/列表)。
  - 基于 HanLP 的依存句法分析结果和规则提取概念间的初步关系并存储。
- **断点预测 (认知陡坡标注 - 已实现初版):**
  - 后端实现基于文本特征（如HanLP提取的术语密度、公式图片数量、段落长度）的"认知陡坡"分析。
  - API 返回认知负荷评估结果。

### 实时辅助交互模块开发 (已部分完成，持续迭代):

- **阅读界面开发 (前端已有基础):** 前端已集成 PDF 阅读器 (`@tato30/vue-pdf`)，支持文本展示。高亮、标注等功能待增强。
- \*\*三级解释系统实现 (后端API已实现，前端集成中):
  - Level 1: 后端可从内存知识图谱获取概念关联信息，并缓存外部 API 的定义。
  - Level 2: 后端已实现 `/definition/{term}` API，调用外部 `OwnThink API` 获取术语定义。
  - Level 3: 上下文增强的逻辑待细化和实现。
- **跨文献跳转与可视化 (规划中):**
  - 实现点击文献引用标识后，若该文献已被预处理，则跳转到其摘要或关键段落视图。
  - （进阶）设计一个可视化界面（如D3.js, ECharts，前端已集成库），展示特定主题或方法在几篇关键文献中的演变路径或关联概念图谱。

### 心流维持与个性化模块开发 (规划中):

- **动态解释窗口:** 实现"画中画"或侧边栏解释窗口，确保其弹出和隐藏不干扰主阅读流程。尝试根据滚动速度或停留时间自动调整信息呈现。
- **注意力保护策略:** 开发"专注模式"，例如通过 CSS 模糊或隐藏非核心界面元素，提供一个计时器功能。
- **阅读轨迹记录:** 后端记录用户点击的概念、查询的解释、停留时间较长的"认知陡坡"区域等交互数据。
- \*\*可视化与知识库 (基础版):
  - 生成简单的用户概念理解图（例如，显示用户查询过的概念及其关联概念）。
  - 根据用户查询频率对解释内容进行排序优化。
  - 实现一个简单的个人词典功能，允许用户添加笔记并关联到文献段落。

### 系统集成、测试与评估 (持续进行):

- **整合:** 持续整合前后端模块，确保数据流畅通和功能协同。
- **测试:** 进行单元测试、集成测试和用户体验测试。
- **评估:** 设计实验任务（如阅读指定论文并回答问题），邀请用户试用，收集心流状态量表、任务完成时间和主观反馈数据。
- **报告撰写:** 撰写课程设计报告，详细阐述项目背景、设计思路、实现过程、遇到的挑战、评估结果和未来展望。

### 预期成果:

- 一个可运行的 Web 应用原型 MindFlow Reader，能够导入 PDF 文献，并提供上述核心功能 (部分已实现，部分规划中)。
- 一套初步构建的内存中的学术领域知识图谱（可针对特定领域）。
- 用户测试报告，包含系统在提升阅读效率和心流体验方面的初步评估数据。
- 一份完整的课程设计报告，展示项目的设计、实现与思考。

## 技术难点与解决方案:

### NLP 准确性 (HanLP API 依赖):

- **难点:** 概念识别和关系提取的准确性受限于 HanLP API 的能力和稳定性。API 调用可能存在网络延迟或服务限制。
- **解决方案:** 优化 API 调用策略 (如批量处理、缓存结果)；允许用户手动修正识别错误；针对特定领域进行规则补充或后处理。考虑 HanLP 本地部署的可能性 (若有此选项且性能满足)。

### 知识图谱构建复杂度 (内存模拟的局限性):

- **难点:** 内存知识图谱在数据持久化、大规模数据处理和复杂查询方面存在局限。自动构建高质量、大规模知识图谱难度大。
- **解决方案:** 当前聚焦于单篇或小范围文献集的"微型"知识图谱；简化关系类型。远期规划中考虑迁移到如图数据库 (Neo4j) 以解决持久化和扩展性问题。

### 外部 API 依赖 (OwnThink, HanLP):

- **难点:** 核心功能依赖外部 API，可能存在服务不稳定、API Key 管理、费用等问题。
- **解决方案:** 实现合理的错误处理和重试机制；缓存 API 返回结果以减少调用次数；探索备用 API 或本地化替代方案 (远期)。

### 断点预测精度:

- **难点:** 精确预测用户卡顿点非常困难，当前基于启发式规则可能不够准确。
- **解决方案:** 持续优化基于文本特征的启发式规则；用户的主动标记（如"这里难懂"）也可作为反馈数据，用于未来可能的模型训练或规则调整。

### 实时交互性能:

- **难点:** 同时处理文本、图谱查询 (即使是内存)、外部 API 调用和界面渲染可能产生延迟。
- **解决方案:** 前端进行懒加载和异步处理；优化后端逻辑和数据结构以提高内存查询效率；对计算密集型任务考虑异步执行。

### 心流的客观测量: 心流是主观体验，难以精确量化。

- 解决方案: 结合主观量表（FSS）和客观行为数据（如阅读速度变化、中断次数、任务完成效率）进行综合评估。重点在于比较使用系统前后或不同功能组合下的相对变化。

### 用户界面设计: 如何设计既能提供丰富辅助又不干扰阅读本身的界面。

- 解决方案: 采用极简设计原则；解释信息按需呈现，避免信息过载；进行多轮用户测试和迭代优化；参考现有成熟阅读软件的交互模式。
